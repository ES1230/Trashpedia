<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">

	<!-- 카테고리 가지고오기 -->
	<select id="getSubCategory" parameterType="subCategory"
		resultType='subCategory'>
		SELECT SUB_CATEGORY_NO, S.BIG_CATEGORY_NO,
		SUB_CATEGORY_NAME, BIG_CATEGORY_NAME
		FROM SUB_CATEGORY S
		JOIN
		BIG_CATEGORY B ON S.BIG_CATEGORY_NO = B.BIG_CATEGORY_NO
		WHERE
		S.SUB_CATEGORY_NO = #{subCategoryNo}
		AND S.BIG_CATEGORY_NO =
		#{bigCategoryNo}
	</select>

	<!-- 게시글 등록(POST) -->
	<insert id="createPost" parameterType="post"
		useGeneratedKeys="true">
		<selectKey keyProperty="postNo" resultType="int"
			order="BEFORE">
			SELECT SEQ_POSTNO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO POST
		VALUES (#{postNo}, #{title}, #{content}, SYSDATE,
		SYSDATE, 'Y')
	</insert>

	<!-- 게시글 등록(BOARD) -->
	<insert id="createBoard" parameterType="board"
		useGeneratedKeys="true">
		<selectKey keyProperty="boardNo" resultType="int"
			order="BEFORE">
			SELECT SEQ_BNO.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO BOARD
		VALUES (#{boardNo}, #{postNo}, 1, #{subCategoryNo},
		'Y')
	</insert>

	<!-- 첨부파일등록 -->
	<insert id="insertAttachment">
		INSERT INTO ATTACHMENT
		VALUES
		(SEQ_ATTNO.NEXTVAL,#{refBno},#{originName},#{changeName},#{fileType},SYSDATE,SYSDATE,'Y')
	</insert>

	<!-- 이미지등록 -->
	<insert id="insertImgAttachment">
		INSERT INTO IMG_ATTACHMENT
		VALUES (SEQ_IATTNO.NEXTVAL,
		#{refBno},#{originName},#{changeName},1,#{imgType},SYSDATE,SYSDATE,'Y')
	</insert>

	<!-- 목록 띄우기 -->
	<!-- <select id="boardList" resultType="post"> -->
	<!-- SELECT P.POST_NO, P.TITLE, P.CONTENT, P.CREATE_DATE, P.MODIFY_DATE, 
		P.STATUS, B.BOARD_NO, SC.SUB_CATEGORY_NAME, M.USER_NAME, COUNT(H.HITS_NO) 
		AS hitCount -->
	<!-- FROM BOARD B -->
	<!-- LEFT JOIN POST P ON (P.POST_NO = B.POST_NO) -->
	<!-- LEFT JOIN SUB_CATEGORY SC ON B.SUB_CATEGORY_NO = SC.SUB_CATEGORY_NO -->
	<!-- LEFT JOIN MEMBER M ON B.USER_NO = M.USER_NO -->
	<!-- LEFT JOIN HITS H ON B.BOARD_NO = H.BOARD_NO -->
	<!-- WHERE -->
	<!-- B.SUB_CATEGORY_NO = #{subCategoryNo} -->
	<!-- AND P.STATUS='Y' -->
	<!-- <if test="searchSelect != null"> -->
	<!-- <if test="searchSelect == 'boardNo'"> -->
	<!-- AND B.BOARD_NO = #{searchValue} -->
	<!-- </if> -->
	<!-- <if test="searchSelect == 'title'"> -->
	<!-- AND P.TITLE = #{searchValue} -->
	<!-- </if> -->
	<!-- <if test="searchSelect == 'content'"> -->
	<!-- AND P.CONTENT = #{searchValue} -->
	<!-- </if> -->
	<!-- </if> -->
	<!-- GROUP BY P.POST_NO, P.TITLE, P.CONTENT, P.CREATE_DATE, P.MODIFY_DATE, 
		P.STATUS, B.BOARD_NO, SC.SUB_CATEGORY_NAME, M.USER_NAME -->
	<!-- ORDER BY -->
	<!-- <if test="filter == 'createDate'"> -->
	<!-- CREATE_DATE DESC -->
	<!-- </if> -->
	<!-- <if test="filter == 'hitCount'"> -->
	<!-- hitCount DESC -->
	<!-- </if> -->
	<!-- </select> -->


	<select id="boardList" resultType="post">
		SELECT P.POST_NO, P.TITLE, P.CONTENT, P.CREATE_DATE, P.MODIFY_DATE,
		P.STATUS, B.BOARD_NO, SC.SUB_CATEGORY_NAME, M.USER_NAME
		FROM BOARD B
		LEFT JOIN POST P ON (P.POST_NO = B.POST_NO)
		LEFT JOIN SUB_CATEGORY SC
		ON B.SUB_CATEGORY_NO = SC.SUB_CATEGORY_NO
		LEFT JOIN MEMBER M ON
		B.USER_NO = M.USER_NO
		LEFT JOIN HITS H ON B.BOARD_NO = H.BOARD_NO
		<!-- WHERE -->
		<!-- B.SUB_CATEGORY_NO = #{subCategoryNo} -->
		<!-- AND P.STATUS='Y' -->
		<!-- <if test="searchSelect != null"> -->
		<!-- <if test="searchSelect == 'boardNo'"> -->
		<!-- AND B.BOARD_NO = #{searchValue} -->
		<!-- </if> -->
		<!-- <if test="searchSelect == 'title'"> -->
		<!-- AND P.TITLE = #{searchValue} -->
		<!-- </if> -->
		<!-- <if test="searchSelect == 'content'"> -->
		<!-- AND P.CONTENT = #{searchValue} -->
		<!-- </if> -->
		<!-- </if> -->
		<!-- GROUP BY P.POST_NO, P.TITLE, P.CONTENT, P.CREATE_DATE, P.MODIFY_DATE, 
			P.STATUS, B.BOARD_NO, SC.SUB_CATEGORY_NAME, M.USER_NAME -->
		<!-- ORDER BY -->
		<!-- <if test="filter == 'createDate'"> -->
		<!-- CREATE_DATE DESC -->
		<!-- </if> -->
		<!-- <if test="filter == 'hitCount'"> -->
		<!-- hitCount DESC -->
		<!-- </if> -->
	</select>

	<select id="boardCount" resultType="int">
		SELECT COUNT(*)
		FROM POST
	</select>




	<!-- 상세페이지 -->
	<select id="boardDetail" parameterType="int" resultType="post">
		SELECT
		P.POST_NO, P.TITLE, P.CONTENT, P.CREATE_DATE, P.MODIFY_DATE,
		B.USER_NO, B.BOARD_NO
		FROM POST P
		LEFT JOIN BOARD B ON P.POST_NO =
		B.POST_NO
		LEFT JOIN MEMBER M ON B.USER_NO = M.USER_NO
		WHERE P.POST_NO =
		#{postNo} AND P.STATUS = 'Y'
	</select>

	<!-- 대분류 카테고리 -->
	<select id="bigCategory" resultType="bigCategory">
		SELECT *
		FROM BIG_CATEGORY
	</select>

	<!-- 소분류 카테고리 -->
	<select id="subCategory" resultType="subCategory">
		SELECT *
		FROM SUB_CATEGORY
	</select>

	<!-- 카테고리 글목록 리스트 -->
	<select id="categoryList" resultType="post">
		SELECT P.POST_NO, P.TITLE,
		M.USER_NAME, P.CREATE_DATE
		FROM BOARD B
		LEFT JOIN POST P ON B.POST_NO =
		P.POST_NO
		LEFT JOIN MEMBER M ON B.USER_NO = M.USER_NO
	</select>






	<!-- 무료 나눔 페이지 관련 쿼리문 -->

	<!-- 쓰레기 리스트 -->
	<select id="getFreeTrashList" resultType="Board">
		SELECT * FROM BOARD
	</select>

	<!-- 이미지 -->
	<select id="getImageUrlByTrashNo" resultType="String"
		parameterType="int">
		<![CDATA[
		SELECT ORIGIN_NAME
		FROM IMAGE_ATTACHMENT IA
		WHERE IA.POST_NO = (SELECT POST_NO 
							FROM BOARD 
							WHERE BOARD_NO=#{boardNo})
		AND IMG_TYPE = 1 
		AND IMG_LEVEL = 1;

	    ]]>
	</select>

	<!-- 타이틀 -->
	<select id="getgetTrashTitleByTrashNo" resultType="String"
		parameterType="int">
		<![CDATA[
        	SELECT TRASH_TITLE
		    FROM TRASH_POST
		    WHERE TRASH_POST_NO = (SELECT POST_NO 
							FROM BOARD 
							WHERE BOARD_NO=#{boardNo})
	    ]]>
	</select>

	<!-- Board 내용 -->
	<select id="getTrashContentByboardNo" resultType="String"
		parameterType="int">
		<![CDATA[
        	SELECT TRASH_CONTENT
		    FROM TRASH_POST
		    WHERE TRASH_POST_NO = (SELECT POST_NO 
							FROM BOARD 
							WHERE BOARD_NO=#{boardNo})
	    ]]>
	</select>



	<!-- 무료나눔 상세페이지 -->
	<!-- Board 내용 -->
	<select id="getFreeTrashDetail" resultType="Board"
		parameterType="int">
		<![CDATA[
        	SELECT *
			FROM BOARD 
			WHERE BOARD_NO=#{boardNo}
	    ]]>
	</select>

	<!-- 작성자 -->
	<select id="getTrashWriterByboardNo" resultType="String"
		parameterType="int">
		<![CDATA[
        	SELECT USER_NICKNAME
        	FROM MEMBER
        	WHERE USER_NO=(SELECT USER_NO
        				    FROM BOARD
        				    WHERE BOARD_NO=#{boardNo})
	    ]]>
	</select>

	<!-- 작성일 -->
	<select id="getTrashCreateByboardNo" resultType="String"
		parameterType="int">
		<![CDATA[
        	SELECT CREATE_DATE
			FROM POST 
			WHERE POST_NO=(SELECT POST_NO
							FROM BOARD
							WHERE BOARD_NO=#{boardNo})
	    ]]>
	</select>

	<!-- 좋아요 -->
	<select id="getTrashViewsByboardNo" resultType="String"
		parameterType="int">
		<![CDATA[
        	SELECT CREATE_DATE
			FROM POST 
			WHERE POST_NO=(SELECT POST_NO
							FROM BOARD
							WHERE BOARD_NO=#{boardNo})
	    ]]>
	</select>





</mapper>